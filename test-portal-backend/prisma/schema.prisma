generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(cuid()) // Changed
  name          String
  email         String         @unique
  phone         String
  note          String
  role          UserRole       @default(PARTICIPANT)
  status        UserStatus     @default(PENDING)
  createdAt     DateTime       @default(now())
  lastActivity  DateTime?

  // Relations
  createdTests  Test[]             @relation("CreatedTests")
  assignments   TestAssignment[]
  attempts      TestAttempt[]
  batchMembers  BatchParticipant[]
}

enum UserRole {
  ADMIN
  PARTICIPANT
}

enum UserStatus {
  PENDING
  ACTIVE
  INACTIVE
}

model Test {
  id            String        @id @default(cuid()) // Changed
  title         String
  description   String?
  createdById   String // Changed
  createdAt     DateTime      @default(now())
  groupId       String
  // Relations
  group         QuestionGroup @relation(fields: [groupId], references: [id])
  createdBy     User          @relation("CreatedTests", fields: [createdById], references: [id])
  assignments   TestAssignment[]
  attempts      TestAttempt[]
  batchTests    BatchTest[]
  
}

model TestAssignment {
  id          String   @id @default(cuid()) // Changed
  userId      String // Changed
  testId      String // Changed
  assignedAt  DateTime @default(now())

  // Relations
  user        User     @relation(fields: [userId], references: [id])
  test        Test     @relation(fields: [testId], references: [id])

  @@unique([userId, testId])
}

model TestAttempt {
  id           String    @id @default(cuid()) // Changed
  userId       String // Changed
  testId       String // Changed
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  score        Float?

  // Relations
  user         User      @relation(fields: [userId], references: [id])
  test         Test      @relation(fields: [testId], references: [id])

  @@unique([userId, testId])
}

model Batch {
  id        String    @id @default(cuid()) // Changed
  name      String
  createdAt DateTime  @default(now())

  // Relations
  participants BatchParticipant[]
  tests        BatchTest[]
}

model BatchParticipant {
  id        String   @id @default(cuid()) // Changed
  groupId   String // Changed
  userId    String // Changed
  joinedAt  DateTime @default(now())

  batch     Batch @relation(fields: [groupId], references: [id])
  user      User  @relation(fields: [userId], references: [id])

  @@unique([groupId, userId])
}

model BatchTest {
  id      String @id @default(cuid()) // Changed
  groupId String // Changed
  testId  String // Changed

  batch   Batch @relation(fields: [groupId], references: [id])
  test    Test  @relation(fields: [testId], references: [id])

  @@unique([groupId, testId])
}


model QuestionGroup {
  id          String      @id @default(cuid())
  name        String
  questions   Question[]
  createdAt   DateTime    @default(now())
 

  Test Test[]
}

model Question {
  id            String  @id @default(cuid())
  question      String
  type          String
  difficulty    String
  options       String[]    // store array of options
  correctAnswer String
  explanation   String?
  points        Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  groupId       String
  group         QuestionGroup @relation(fields: [groupId], references: [id])
}

